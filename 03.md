Lud-03： `withdrawRequest` 基本规格
====================================

 `author: akumaigorodski`

---

## 从服务中提取资金

如今，用户被要求向服务提供提款闪电发票。这需要一些努力，当用户在使用桌面网站时试图将资金提取到移动钱包中时，这尤其痛苦。而不是要求闪电发票，服务可以显示一个“撤回”二维码，其中包含一个专门 `LNURL` 的。

### 钱包到服务交互流程：

1. 用户扫描 LNURL QR 码或访问 `lightning:LNURL..` 链接 `LN WALLET` 并 `LN WALLET` 解码 LNURL.
2. 使用解码的 LNURL 向 `LN SERVICE` `LN WALLET` 发出 GET 请求。
3. 从 `LN SERVICE` 以下格式 `LN WALLET` 获取 JSON 响应：

    ```Typescript
    {
        "tag": "withdrawRequest", // type of LNURL
        "callback": string, // The URL which LN SERVICE would accept a withdrawal Lightning invoice as query parameter
        "k1": string, // Random or non-random string to identify the user's LN WALLET when using the callback URL
        "defaultDescription": string, // A default withdrawal invoice description
        "minWithdrawable": number, // Min amount (in millisatoshis) the user can withdraw from LN SERVICE, or 0
        "maxWithdrawable": number, // Max amount (in millisatoshis) the user can withdraw from LN SERVICE, or equal to minWithdrawable if the user has no choice over the amounts
    }
    ```
    或


    ```JSON
    {"status": "ERROR", "reason": "error details..."}
    ```
4.  `LN WALLET` 显示“取款”对话框，用户可以在其中指定要取款的确切金额，该金额的范围为：

    ```
    max can receive = min(maxWithdrawable, local estimation of how much can be routed into wallet)
    min can receive = max(minWithdrawable, local minimal value allowed by wallet)
    ```
5. 一旦被用户接受，就 `LN WALLET` 会 `LN SERVICE` 以

    ```
    <callback>
      <?|&> // either '?' or '&' depending on whether there is a query string already in the callback
       k1=<k1> // the k1 specified in the response above
      &pr=<lightning invoice> // the payment request generated by the wallet
    ```
6.  `LN SERVICE` 发送 `{"status": "OK"}` 或 `{"status": "ERROR", "reason": "error details..."}` JSON 响应，然后尝试异步支付发票。
7. 如果响应成功， `LN WALLET` 则等待传入付款。

请注意，该服务将向任何能够提供有效临时帐户 `k1` 的人提取资金。为了强化这一点，在显示撤销 QR 之前，服务可能需要授权（LNURL-AUTH、电子邮件链接等）。
